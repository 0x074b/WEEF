# cscript.exe / wscript.exe
## What is it?
*```cscript.exe``` and ```wscript.exe``` are Windows-based scripting engines used to execute scripts written in languages such as **VBScript** or **JScript**.*
*These utilities are typically used for automation tasks, running scripts, or managing system configurations. Both tools can run scripts in the command-line interface (cscript.exe) or in a graphical user interface (wscript.exe). As built-in Windows utilities, they are trusted by the system and often overlooked by security tools.*

## Legitimate Usage
- **Automation of Tasks** → Running scripts to automate system administration tasks such as network configuration or user management.
- **System Diagnostics** → Use scripts to gather system information or perform troubleshooting tasks.
- **Software Installation & Configuration** → Execute installation or setup scripts for software deployment.
- **Batch Operations** → Execute multiple commands or script sequences to perform complex tasks in an efficient manner.

## How to abuse it
- **Bypassing Security Controls** → Because ```cscript.exe``` and ```wscript.exe``` are trusted Windows tools, attackers can use them to bypass application whitelisting or security measures.
- **Persistence** → Attackers can place malicious scripts in startup locations, which will automatically execute when the system starts or the user logs in.
- **Credential Theft** → Attackers can use these tools to steal credentials from the system by running malicious scripts that harvest user input or sensitive information.
- **Command and Control (C2) Communication** → Attackers can leverage scripts to communicate with external C2 servers, exfiltrating data or receiving new commands.
- **Social Engineering** → Malicious scripts executed via ```wscript.exe``` can be embedded in files that trick users into running them, allowing for exploitation.

## Example attacks
### 1. Running Malicious Scripts
*Attackers can use ```cscript.exe``` or ```wscript.exe``` to execute a malicious script that performs various tasks such as downloading malware or stealing data.*
**Execute Malicious PowerShell Script**

```
cscript.exe //nologo malicious.vbs
```

**Effect:**
- Executes a script that downloads and executes a PowerShell payload, bypassing security controls.

### 2. Persistence via Startup
*Attackers can use ```cscript.exe``` or ```wscript.exe``` to run malicious scripts on startup, ensuring persistence even after system reboots.*
**Create Persistent Script via Startup Folder**

```
echo cscript.exe //nologo C:\malicious\payload.vbs >> C:\Users\user\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\malicious.vbs
```

**Effect:**
- Places a script in the startup folder, which ensures the malicious script runs every time the user logs on.

### 3. Exfiltration of Data
*Attackers can use ```cscript.exe``` or ```wscript.exe``` to exfiltrate data by executing scripts that send sensitive files to an external server.*
**Exfiltrate Data via HTTP**

```
cscript.exe //nologo exfiltrate.vbs
```

**Effect:**
- Uses a VBScript to exfiltrate data to a remote server, bypassing traditional file transfer monitoring methods.

### 4. Lateral Movement Using Malicious Scripts
*```cscript.exe``` and ```wscript.exe``` can be used for lateral movement, where attackers copy malicious scripts across the network to other machines.*
**Run Script Remotely via WMI**

```
wmic /node:192.168.1.50 process call create "cscript.exe //nologo C:\malicious\payload.vbs"
```

**Effect:**
- Executes a malicious script on a remote machine via Windows Management Instrumentation (WMI), potentially spreading malware.

### 5. Social Engineering via Malicious Scripts
*Attackers can use ```wscript.exe``` to run scripts that appear benign to users but actually perform malicious actions.*
**Embed Malicious Script in a Document**

```
wscript.exe C:\Documents\malicious_script.vbs
```

**Effect:**
- Executes a malicious script that can harvest user credentials or install malware when the document is opened.

# Detection & Mitigation
## Detection Methods
**Monitor Script Execution**
- **Event ID 4688 (New Process Creation)** → Detect ```cscript.exe``` or ```wscript.exe``` running from unusual or suspicious locations.
- **Look for Suspicious Scripts** → Monitor for scripts being executed from non-standard directories, like temporary folders or user profiles.

**File Integrity Monitoring**
- **Check for Unexpected Script Changes** → Watch for modifications to known scripts or scripts being placed in sensitive locations.

**Network Monitoring**
- **Detect Unauthorized HTTP Requests** → Monitor for unauthorized outbound HTTP traffic that may indicate data exfiltration via script.

## Mitigation Strategies
- **Application Whitelisting** → Use application control to block the execution of scripts or restrict script execution to trusted paths.
- **Restrict User Privileges** → Limit the ability of users to execute scripts using ```cscript.exe``` or ```wscript.exe``` by applying least privilege access controls.
- **Script Block Logging** → Use security tools to block known malicious scripts and log their execution to identify malicious activity.
- **Disable Windows Script Host** → In environments where scripts are not needed, disable the Windows Script Host feature to prevent the execution of scripts.
