# dotnet.exe
## What is it?
*```dotnet.exe``` is the .NET Core runtime executable used to run applications developed with the .NET framework.*
*It is a legitimate part of the .NET ecosystem and is used to run applications that are built using .NET Core or .NET 5+ technology, allowing for cross-platform application deployment and execution.*

## Legitimate Usage
- **Running .NET Applications** → Use to execute .NET Core applications on Windows, Linux, or macOS.
- **Cross-Platform Development** → Enables developers to create and run applications that work across different operating systems.
- **Development & Testing** → Used in development environments for running and debugging .NET applications.
- **Package Management** → Executes commands to install, update, or remove packages within a .NET Core project.

## How to abuse it
- **Bypassing Security Controls** → Since ```dotnet.exe``` is a trusted Windows binary, attackers can use it to bypass application whitelisting or security measures.
- **Malicious Payload Execution** → Attackers can package malicious payloads as .NET applications and use ```dotnet.exe``` to execute them on the target system.
- **Persistence** → Attackers can set up .NET-based backdoors or malicious applications to run persistently via scheduled tasks or startup entries.
- **Command & Control (C2)** → Attackers can leverage .NET applications to communicate with a C2 server, receive commands, or exfiltrate data.
- **Obfuscation** → .NET applications can be compiled and obfuscated to make it harder for security software to detect malicious activity.

## Example attacks
### 1. Running Malicious .NET Application
*Attackers can use ```dotnet.exe``` to run a malicious .NET application that downloads and executes further payloads or performs malicious activities.*

**Execute Malicious Payload**

```
dotnet.exe malicious_app.dll
```

**Effect:**
- Executes a compiled .NET application that may download additional malware, steal data, or carry out other malicious actions.

### 2. Persistence via Scheduled Task
*Attackers can create a scheduled task that runs a malicious .NET application every time the system starts or at regular intervals.*

**Create Scheduled Task to Run Malicious App**

```
schtasks /create /tn "MaliciousApp" /tr "dotnet.exe C:\path\to\malicious_app.dll" /sc onlogon /ru SYSTEM
```

**Effect:**
- The malicious .NET application runs every time the user logs in or the system reboots, ensuring persistence.

### 3. Lateral Movement Using .NET Application
*Attackers can use ```dotnet.exe``` to run a malicious .NET application on remote systems, facilitating lateral movement.*

**Execute .NET Application Remotely Using PowerShell**

```
Invoke-Command -ComputerName 192.168.1.50 -ScriptBlock { dotnet.exe C:\path\to\malicious_app.dll }
```

**Effect:**
- Executes the malicious application on a remote system, allowing attackers to move laterally within the network.

### 4. Command & Control (C2) Communication
*```dotnet.exe``` can be used by attackers to communicate with an external C2 server to send and receive commands.*

**C2 Communication Example**

```
dotnet.exe C:\path\to\c2_client.dll
```

**Effect:**
- The malicious .NET application connects to the attacker's C2 server to receive commands or exfiltrate data.

### 5. Exfiltration of Data
*Attackers can use a .NET application executed with ```dotnet.exe``` to exfiltrate data to an external server.*

**Exfiltrate Data via HTTP**

```
dotnet.exe C:\path\to\exfiltrate_data.dll
```

**Effect:**
- The .NET application uploads sensitive data to an external server, potentially bypassing traditional file transfer monitoring.

# Detection & Mitigation
## Detection Methods
**Monitor for Suspicious Use of dotnet.exe**
- **Event ID 4688 (New Process Creation)** → Detect ```dotnet.exe``` running from unusual locations or with suspicious command-line arguments.
- **Look for .NET Executables** → Monitor for unknown or unauthorized .NET applications being executed.

**Monitor Network Traffic**
- **Event ID 5156 (Windows Filtering Platform)** → Detect unusual outbound connections, especially to unknown servers or unusual ports, often indicative of exfiltration or C2 communication.
- **Look for HTTP/HTTPS Requests** → Monitor network traffic for large or suspicious file uploads via HTTP, often used for exfiltration.

**Audit Scheduled Tasks**
- **Event ID 4698 (Scheduled Task Created)** → Detect attempts to create tasks that run malicious .NET applications on a scheduled basis.

## Mitigation Strategies
- **Application Whitelisting** → Use application control policies to restrict the execution of unapproved .NET applications.
- **Restrict User Privileges** → Limit the ability of non-administrative users to run .NET applications or install new ones.
- **Monitor for Unusual File Access** → Use file integrity monitoring to detect unexpected file movements or access, particularly in directories where executable files are stored.
- **Disable or Limit .NET Execution** → Disable the execution of .NET applications on machines that do not require them for legitimate business purposes.
