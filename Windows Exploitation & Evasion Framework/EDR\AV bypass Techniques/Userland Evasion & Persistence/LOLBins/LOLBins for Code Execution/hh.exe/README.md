# hh.exe
## What is it?
*```hh.exe``` (HTML Help Executable) is a built-in Windows utility used to open and display Help documentation files in the HTML Help (.chm) format.*
*It is primarily used by developers and system administrators to view context-sensitive help or documentation integrated within applications or Windows itself.*

## Legitimate Usage
- **Viewing Help Files** → Open and view Help documentation in the .chm format.
- **System Administration** → Access built-in system help files or application-specific documentation.
- **Software Development** → Developers use ```hh.exe``` to view context-sensitive help or custom documentation packaged with their software.

## How to abuse it
- **Bypassing Security Controls** → Attackers can use ```hh.exe``` to execute malicious code hidden within a .chm file or linked content.
- **Fileless Execution** → Attackers can trigger malicious scripts or payloads through specially crafted help files that are loaded with ```hh.exe```.
- **Social Engineering** → By disguising a malicious .chm file as a legitimate help document, attackers can trick users into opening it and executing malicious code.
- **Persistence** → Attackers can use ```hh.exe``` to open a malicious .chm file on startup or as part of a scheduled task, ensuring that their malicious code executes automatically.

## Example attacks
### 1. Exploiting .chm Files for Code Execution
*Attackers can create a malicious .chm file that executes code when opened by ```hh.exe```.*
**Open Malicious .chm File via hh.exe**

```
hh.exe C:\path\to\malicious_help.chm
```

**Effect:**
- Executes malicious code embedded in the .chm file, potentially leading to a remote code execution (RCE) attack.

### 2. Fileless Execution via Embedded Scripts
*Malicious scripts (e.g., JavaScript or VBScript) can be embedded inside a .chm file and executed when opened with ```hh.exe```.*
**Embed Malicious Script in .chm File**

```
hh.exe C:\path\to\malicious_script.chm
```

**Effect:**
- Executes the embedded script without creating any additional files, bypassing traditional file-based security detection.

### 3. Social Engineering Attack with Malicious Help File
*Attackers can distribute a seemingly legitimate .chm file that actually contains malicious payloads.*
**Trick User into Opening Malicious Help File**

```
hh.exe C:\Users\Victim\Downloads\legitimate_help.chm
```

**Effect:**
- Executes a malicious payload disguised as a help file, potentially leading to credential theft, backdoor installation, or ransomware deployment.

### 4. Persistence via Startup Folder
*By placing a malicious .chm file in the startup folder, attackers can ensure that malicious code executes every time the system reboots.*
**Place Malicious .chm in Startup**

```
copy C:\path\to\malicious_help.chm C:\Users\Victim\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
```

**Effect:**
- Malicious code in the .chm file runs automatically every time the system starts up.

### 5. Abuse via Task Scheduler
*Attackers can schedule ```hh.exe``` to run at specific times, opening malicious .chm files without user interaction.*
**Create Scheduled Task to Open Malicious Help File**

```
schtasks /create /tn "MaliciousHelp" /tr "hh.exe C:\path\to\malicious_help.chm" /sc daily /ru SYSTEM
```

**Effect:**
- Executes the malicious .chm file at scheduled times, ensuring that the attacker’s code runs without direct user interaction.

# Detection & Mitigation
## Detection Methods
**Monitor Help File Executions**
- **Event ID 4688 (Process Creation)** → Detect the execution of ```hh.exe``` with suspicious arguments, particularly from untrusted directories.
- **Look for Unusual File Extensions** → Watch for .chm files being executed via ```hh.exe``` from unusual locations or in contexts where help files are not typically used.

**Monitor Scheduled Task Creation**
- **Event ID 4698 (Scheduled Task Created)** → Look for scheduled tasks that open help files with ```hh.exe``` in suspicious contexts or from unknown directories.

**Monitor User Downloads and File Access**
- **Event ID 4663 (File Accessed)** → Detect when a .chm file is accessed, especially in directories where users don't typically open help files.

## Mitigation Strategies
- **Block Untrusted Help Files** → Configure security software to block the execution of .chm files from untrusted sources or locations.
- **Restrict Execution of hh.exe** → Use AppLocker or Windows Defender Application Control (WDAC) to restrict the execution of ```hh.exe``` to trusted applications only.
- **Educate Users About Social Engineering** → Train users to be cautious when opening help files, especially from email attachments or unknown sources.
- **Use URL Filtering** → Prevent malicious or suspicious links within help files by using URL filtering solutions to block known malicious URLs embedded within .chm files.
- **Monitor for Persistence Mechanisms** → Watch for .chm files placed in the startup folder or scheduled tasks that execute ```hh.exe``` to ensure attackers cannot achieve persistence.
