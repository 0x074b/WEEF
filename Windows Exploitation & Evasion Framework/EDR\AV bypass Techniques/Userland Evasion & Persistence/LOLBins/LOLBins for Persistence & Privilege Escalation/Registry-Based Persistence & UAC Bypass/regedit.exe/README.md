# regedit.exe
## What is it?
*```regedit.exe``` is a **built-in Windows registry editor** used to view, modify, and delete registry keys and values. It is the graphical version of the command-line utility ```reg.exe```, providing users with a more accessible interface for managing the Windows registry.*

*As a trusted system tool, it is often overlooked by security software, making it useful for attackers to modify registry settings to evade detection or maintain persistence.*

## Legitimate Usage
- **System Configuration** → Edit the Windows registry to configure system settings, such as user preferences, hardware configurations, or software settings.
- **Troubleshooting** → Modify registry values to resolve system errors or application-specific issues.
- **Backup & Restore** → Export and import registry keys to back up system settings or restore configuration files.
- **Software Customization** → Set application-specific settings and preferences by modifying the registry.

## How to abuse it
- **Persistence** → Attackers can create registry entries to ensure malicious software runs at startup or during specific events.
- **Bypassing Security Controls** → Modify registry keys associated with security mechanisms (such as UAC or antivirus) to disable or bypass them.
- **Hiding Malicious Activity** → Remove or alter registry keys related to security tools or event logs to cover tracks.
- **Privilege Escalation** → Modify registry keys that control user privileges or access control to escalate privileges or execute malicious code with elevated rights.

## Example attacks
### 1. Persistence via Registry Key Creation
*Attackers can create a registry key to ensure that malicious software runs every time the user logs in by adding an entry to the `HKCU\Software\Microsoft\Windows\CurrentVersion\Run` location.*

**Add Malicious Entry to Startup**

```
regedit.exe /s "C:\path\to\malicious.reg"
```

**Effect:**
- **Malicious registry entry** is created, ensuring that the malware is executed every time the user logs in.

### 2. Disabling Windows Defender via Registry Modification
*Attackers can disable security software such as Windows Defender by modifying registry values.*

**Disable Windows Defender Antivirus**

```
regedit.exe /s "C:\path\to\disable_defender.reg"
```

**Effect:**
- **Windows Defender** is disabled by changing registry values, allowing malware to run without detection.

### 3. Bypassing User Account Control (UAC)
*Attackers can modify registry values related to UAC to reduce security prompts and gain elevated privileges.*

**Lower UAC Security Settings**

```
regedit.exe /s "C:\path\to\disable_uac.reg"
```

**Effect:**
- **UAC** is disabled or reduced, enabling malware to run without triggering security warnings.

### 4. Hiding Malicious Files or Processes
*```regedit.exe``` can be used to remove or modify registry keys related to antivirus or event logging, allowing attackers to evade detection.*

**Remove Registry Key for Security Software**

```
regedit.exe /s "C:\path\to\remove_security.reg"
```

**Effect:**
- **Security software registry entries** are removed, allowing malicious files or processes to run undetected.

### 5. Privilege Escalation via Registry Manipulation
*Attackers can modify registry keys related to user privileges to gain higher-level access, such as administrator privileges.*

**Escalate Privileges via Registry Modification**

```
regedit.exe /s "C:\path\to\escalate_privileges.reg"
```

**Effect:**
- **User privileges** are modified, allowing attackers to execute commands with elevated privileges.

# Detection & Mitigation
## Detection Methods
**Monitor Registry Changes**
- **Event ID 4657 (Registry Value Modified)** → Detect suspicious changes to registry keys, especially related to startup programs or security settings.
- **Look for Registry Modifications in Common Persistence Locations** → Monitor paths like **HKCU\Software\Microsoft\Windows\CurrentVersion\Run** and **HKLM\Software\Microsoft\Windows\CurrentVersion\Run** for unauthorized entries.

**Monitor Execution of ```regedit.exe```**
- **Event ID 4688 (Process Creation)** → Monitor the execution of **regedit.exe** for unusual command-line arguments that could indicate an attack (e.g., silent modifications).
- **Look for the Use of `.reg` Files** → Track the execution of **.reg** files being imported by **regedit.exe**, especially those that modify security settings or introduce new persistence mechanisms.

## Mitigation Strategies
- **Restrict Access to ```regedit.exe```** → Use application control policies like **AppLocker** or **WDAC** to prevent unauthorized access to **regedit.exe**.
- **Monitor Registry Changes** → Implement regular audits of critical registry locations to detect suspicious modifications.
- **Enforce User Account Control (UAC)** → Ensure that UAC is enabled to block unauthorized changes to the registry.
- **Use Endpoint Detection and Response (EDR)** → Deploy EDR solutions to monitor registry modifications and flag suspicious behaviors.
