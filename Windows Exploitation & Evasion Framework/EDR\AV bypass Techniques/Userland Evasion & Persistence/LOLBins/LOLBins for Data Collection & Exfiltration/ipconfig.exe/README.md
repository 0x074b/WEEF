# ipconfig.exe  

## What is it?  
***`ipconfig.exe`** (Internet Protocol Configuration) is a **built-in Windows command-line tool** used to **display and manage network configuration** settings.  
It is commonly used by administrators and users to troubleshoot network issues, retrieve IP addresses, and reset network adapters.*

*Because it is a **trusted system utility**, security tools **do not flag its execution**, making it a valuable tool for attackers.*

## **Legitimate Usage**  
- **View Network Configuration** → Retrieve IP address, subnet mask, and gateway (`ipconfig`)  
- **Refresh or Release IP Address** → Renew DHCP leases (`ipconfig /renew`)  
- **Flush DNS Cache** → Resolve domain issues (`ipconfig /flushdns`)  
- **Display DNS Resolver Cache** → View recent DNS queries (`ipconfig /displaydns`)  

## **How to Abuse it**  
- **Network Reconnaissance** → Gather information on network configuration, available interfaces, and routing details  
- **Identify Internal IP Ranges** → Useful for lateral movement within corporate networks  
- **Enumerate VPN & Proxy Settings** → Detect potential security measures or misconfigurations  
- **Clear DNS Cache to Evade Detection** → Prevent forensic investigators from tracking past DNS queries  

## **Example Attacks**  

### **1. Discover Local Network Information**  
*Attackers can use `ipconfig.exe` to **map out** the victim’s network and find critical details.*

**Retrieve IP Address & Network Info:**  

```
ipconfig /all
```

**Effect:**  
- Reveals **internal IP address**, **MAC address**, **gateway**, and **DNS servers**  
- Identifies **proxy servers** and **VPN interfaces**  

### **2. Detect Active VPNs & Tunnels**  
*Attackers can **check if a target is using a VPN** or **detect remote connections**.*

**List All Interfaces:**  

```
ipconfig /all | findstr "PPP TUN"
```

**Effect:**  
- Identifies VPN or tunnel adapters, helping attackers bypass security controls  

### **3. Flush DNS to Evade Tracking**  
*To remove evidence of malicious DNS queries, an attacker can **clear the DNS cache**.*

**Flush DNS Cache:**  

```
ipconfig /flushdns
```

**Effect:**  
- Erases local DNS history, making it harder for defenders to trace malicious domain lookups  

### **4. Bypass Network Restrictions with Proxy Detection**  
*Attackers can check if a system is using a **corporate proxy** and attempt to exploit it.*

**Detect Proxy Settings:**  

```
ipconfig /all | findstr "Proxy"
```

**Effect:**  
- Identifies potential **proxy misconfigurations** that can be leveraged for data exfiltration  

## **Detection & Mitigation**  

### **Detection Methods**  
**Monitor Unusual Network Commands**  
- **Look for excessive `ipconfig.exe` executions** in short timeframes  
- **Correlate with other reconnaissance commands** (e.g., `netstat`, `arp`, `route`)  

**Detect Frequent DNS Flushes**  
- **Monitor Event ID 8019 (DNS Client Events)** for excessive `ipconfig /flushdns` usage  

### **Mitigation Strategies**  
- **Restrict Unnecessary Access** → Limit command execution for non-administrative users  
- **Log Network Commands** → Enable process auditing to track `ipconfig.exe` execution  
- **Monitor DNS Activity** → Detect abnormal patterns of DNS cache clearing  
