# nbtstat.exe  

## What is it?  
*`nbtstat.exe` (NetBIOS over TCP/IP Statistics) is a built-in Windows command-line tool used to troubleshoot NetBIOS name resolution issues.  
It allows users to view active NetBIOS connections, resolve remote machine names, and clear NetBIOS name caches.*

*Because it is a trusted system utility, security tools do not flag its execution, making it a valuable tool for attackers conducting reconnaissance.*

## Legitimate Usage  
- *Display NetBIOS Name Cache* → View cached NetBIOS name-to-IP mappings (`nbtstat -c`)  
- *Flush NetBIOS Cache* → Remove all cached names (`nbtstat -R`)  
- *Query NetBIOS Name Table* → Retrieve remote machine details (`nbtstat -A <IP>` or `nbtstat -a <hostname>`)  
- *Display Active NetBIOS Sessions* → Identify current network connections (`nbtstat -S`)  

## How to Abuse it  
- *Network Reconnaissance* → Gather information on active network connections and remote machines  
- *Identify Internal Systems* → Enumerate NetBIOS names to identify workstations and servers  
- *Bypass Security Monitoring* → Since `nbtstat.exe` is a built-in tool, many security tools overlook its usage  
- *Evade Detection by Flushing Name Cache* → Remove traces of NetBIOS lookups  

## Example Attacks  

### 1. Enumerate Network Hosts  
*Attackers can use `nbtstat.exe` to identify active machines on a network.*

*Retrieve NetBIOS Table of a Target Machine:*  

```
nbtstat -A <IP>
```

*Effect:*  
- Displays the NetBIOS name table for the target system  
- Reveals hostname, workgroup, and potential logged-in users  

### 2. Identify Active Network Sessions  
*Attackers can view existing NetBIOS connections to understand ongoing communications.*

*List Active NetBIOS Sessions:*  

```
nbtstat -S
```

*Effect:*  
- Shows open NetBIOS connections, helping attackers identify targets for lateral movement  

### 3. Flush NetBIOS Cache to Cover Tracks  
*An attacker can erase evidence of NetBIOS queries by clearing the name cache.*

*Flush the NetBIOS Name Cache:*  

```
nbtstat -R
```

*Effect:*  
- Removes all previously resolved NetBIOS names, making it harder for defenders to track past queries  

### 4. Scan for Active Windows Machines  
*Attackers can use NetBIOS enumeration to locate other Windows machines on the network.*

*Check if a Host is Running Windows:*  

```
nbtstat -a <hostname>
```

*Effect:*  
- Identifies remote Windows machines  
- Provides machine names, workgroups, and user information  

## Detection & Mitigation  

### Detection Methods  
*Monitor Unusual NetBIOS Queries*  
- Look for frequent `nbtstat -A` or `nbtstat -a` commands querying multiple hosts  
- Correlate with other reconnaissance activity (e.g., `ipconfig`, `net view`, `netstat`)  

*Detect Cache Flush Attempts*  
- Monitor excessive use of `nbtstat -R`, which may indicate an attacker trying to remove traces  

### Mitigation Strategies  
- *Limit NetBIOS Usage* → Disable NetBIOS over TCP/IP if not needed  
- *Monitor Network Activity* → Detect suspicious NetBIOS requests from unauthorized users  
- *Restrict Access to nbtstat.exe* → Use application control (AppLocker, WDAC) to prevent abuse
