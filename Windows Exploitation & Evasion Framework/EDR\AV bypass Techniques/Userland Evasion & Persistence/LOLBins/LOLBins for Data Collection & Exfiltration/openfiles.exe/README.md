# openfiles.exe  

## What is it?  
*`openfiles.exe` is a built-in Windows command-line tool used to display and manage files currently opened by local or remote users.  
It allows administrators to list open files, identify which user has a file locked, and forcibly close file handles.*

*Since `openfiles.exe` is a legitimate Windows tool, its execution is often overlooked by security tools, making it useful for attackers conducting **reconnaissance** and **privilege escalation**.*  

## Legitimate Usage  
- **List Open Files** → Display all files currently accessed (`openfiles /query`)  
- **Identify Who Locked a File** → Find the user or process holding a file open  
- **Close Remote File Handles** → Forcefully close open files (`openfiles /disconnect`)  
- **Enable File Handle Tracking** → Must be enabled before use (`openfiles /local on`)  

## How to Abuse it  
- **Identify High-Value Files** → Attackers can list currently accessed files for exfiltration  
- **Check Privileges & Active Users** → View which files are opened by privileged accounts  
- **Close System Files for Disruption** → Terminate critical system processes by closing handles  
- **Bypass Security Logs** → Access files stealthily without triggering direct file access alerts  

## Example Attacks  

### 1. Enumerate Open Files on the System  
*Attackers can list all currently open files, including files accessed by administrators.*

**List Open Files on the Local Machine:**

```
openfiles /query /fo table /v
```

**Effect:**
- Displays a detailed list of all open files, including usernames and file paths  
- Helps attackers identify sensitive files currently in use  

### 2. Identify High-Privilege File Access  
*Attackers can target files opened by administrators or system processes.*

**List Open Files with User Information:**

```
openfiles /query /fo list
```

**Effect:**  
- Reveals which user has opened a file  
- Helps attackers determine where to escalate privileges  

### 3. Close Open Files to Disrupt Processes  
*An attacker can terminate active file access, forcing users or services to restart.*

**Force Close a Specific Open File:**

```
openfiles /disconnect /id <file_id>
```

**Effect:**
- Interrupts access to a file, causing applications to crash or reset  
- Can be used to disrupt security software or logging processes  

### 4. Enable File Tracking for Persistent Monitoring  
*By enabling tracking, an attacker can passively monitor open files without triggering alerts.*

**Enable Open File Tracking:**

```
openfiles /local on
```

**Effect:**
- Allows `openfiles.exe` to monitor file access on the local system  
- Creates an opportunity for attackers to observe file usage over time  

## Detection & Mitigation  

### Detection Methods  
**Monitor Open File Queries**
- Detect frequent execution of `openfiles /query`, especially by unauthorized users  
- Correlate with privilege escalation attempts  

**Look for Unexpected File Disconnections**
- Identify repeated use of `openfiles /disconnect`, which could indicate system disruption attempts  

### Mitigation Strategies  
- *Limit Access to openfiles.exe* → Use AppLocker or WDAC to restrict execution  
- *Monitor File Access Logs* → Detect abnormal file enumeration activities  
- *Restrict Remote Access* → Disable unnecessary file sharing to reduce attack surface  
