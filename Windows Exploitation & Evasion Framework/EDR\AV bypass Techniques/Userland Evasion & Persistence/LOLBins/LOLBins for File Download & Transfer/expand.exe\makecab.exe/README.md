# expand.exe / makecab.exe  
## What is it?  
*```expand.exe``` and ```makecab.exe``` are **built-in Windows utilities** for managing cabinet (.cab) files.*  
- **```expand.exe```** → Extracts files from .cab archives.  
- **```makecab.exe```** → Creates .cab archives for compression and packaging.  
*These tools are commonly used for **Windows file compression, deployment, and installation processes**.*  
*Since they are **trusted system binaries**, attackers can abuse them to **bypass security controls**.*  

## Legitimate Usage  
- **Extracting Windows system files** → ```expand.exe myfile.cab -F:* C:\Output```  
- **Compressing files into .cab format** → ```makecab.exe myfile.exe myfile.cab```  
- **Deploying software packages** → Used by Windows for packaging system updates.  

## How to abuse it  
- **File Extraction for Malware Deployment** → Extract malicious files stealthily.  
- **Payload Packing & Execution** → Hide malware inside .cab files to evade detection.  
- **Data Exfiltration** → Compress stolen files into a .cab archive before exfiltration.  
- **Bypassing Security Controls** → Trusted Windows binary avoids detection.  

## Example Attacks  
### 1. Extracting Malicious Payload from a .cab Archive  
*Attackers may use ```expand.exe``` to extract a hidden payload.*  

```
expand.exe malware.cab -F:* C:\Temp
```

**Effect:**  
- Extracts **all files** from ```malware.cab``` into ```C:\Temp``` for execution.  

### 2. Packing Malware for Stealthy Delivery  
*Using ```makecab.exe``` to compress malware into a .cab file before sending it to a target.*  

```
makecab.exe payload.exe payload.cab
```

**Effect:**  
- Packages ```payload.exe``` inside ```payload.cab``` to avoid detection.  

### 3. Data Exfiltration via Compressed Archives  
*An attacker can compress stolen files into a .cab archive before exfiltrating them.*  

```
makecab.exe C:\SensitiveData\secrets.txt secrets.cab
```

**Effect:**  
- Compresses **sensitive data** into ```secrets.cab``` for **stealthy exfiltration**.  

### 4. Bypassing Security Controls (Living-off-the-Land)  
*Some security solutions may not inspect .cab files, allowing attackers to store malware inside.*  

```
makecab.exe C:\Evasion\malware.exe C:\Evasion\malware.cab

expand.exe C:\Evasion\malware.cab -F:* C:\Evasion
```

**Effect:**  
- **Bypasses file scanning** by compressing malware and extracting it when needed.  

## Detection & Mitigation  
### Detection Methods  
- **Monitor Usage of `expand.exe` and `makecab.exe`** → Rare in normal workflows.  
- **Look for Unauthorized Archive Creation** → ```makecab.exe``` creating .cab files in suspicious locations.  
- **Track Suspicious File Extraction** → ```expand.exe``` extracting files outside system directories.  

### Mitigation Strategies  
- **Restrict Execution in User Folders** → Block ```expand.exe``` and ```makecab.exe``` usage in non-system directories.  
- **Monitor File Modifications** → Detect unexpected .cab file creation or extraction.  
- **Use Application Control (AppLocker, WDAC)** → Prevent unauthorized usage of these binaries.  
